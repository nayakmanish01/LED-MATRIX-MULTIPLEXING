/*
 * main.c
 *
 * Created: 7/13/2022 10:59:00 PM
 *  Author: MANISH
 */ 

#include <avr/io.h>
#include <util/delay.h>
#define F_CPU 16000000UL
#define dt 1
//First shift register
char dotcontrol[8]={1,2,4,8,16,32,64,128};
unsigned char d[][8]={{
	
	0b11111111,
	0b10000000,
	0b10000000,
	0b11111111,
	0b11111111,
	0b10000000,
	0b10000000,
	0b11111111
	},{
	0b01111111,
	0b01000000,
	0b01000000,
	0b01111111,
	0b01111111,
	0b01000000,
	0b01000000,
	0b01111111
	},{
	0b00111111,
	0b00100000,
	0b00100000,
	0b00111111,
	0b00111111,
	0b00100000,
	0b00100000,
	0b00111111
	},{
	0b00011111,
	0b00010000,
	0b00010000,
	0b00011111,
	0b00011111,
	0b00010000,
	0b00010000,
	0b00011111
	},{
	0b00001111,
	0b00001000,
	0b00001000,
	0b00001111,
	0b00001111,
	0b00001000,
	0b00001000,
	0b00001111
	},{
	0b00000111,
	0b00000100,
	0b00000100,
	0b00000111,
	0b00000111,
	0b00000100,
	0b00000100,
	0b00000111
	},{
	0b00000011,
	0b00000010,
	0b00000010,
	0b00000011,
	0b00000011,
	0b00000010,
	0b00000010,
	0b00000011
	},{
	0b00000001,
	0b00000001,
	0b00000001,
	0b00000001,
	0b00000001,
	0b00000001,
	0b00000001,
	0b00000001
	},{
	0b10000001,
	0b11000011,
	0b01100110,
	0b00111100,
	0b00011000,
	0b00011000,
	0b00011000,
	0b00011000
	},{
	0b01000000,
	0b01100001,
	0b00110011,
	0b00011110,
	0b00001100,
	0b00001100,
	0b00001100,
	0b00001100
	},{
	0b00100000,
	0b00110000,
	0b00011001,
	0b00001111,
	0b00000110,
	0b00000110,
	0b00000110,
	0b00000110
	},{
	0b00010000,
	0b00011000,
	0b00001100,
	0b00000111,
	0b00000011,
	0b00000011,
	0b00000011,
	0b00000011
	},{
	0b00001000,
	0b00001100,
	0b00000110,
	0b00000011,
	0b00000001,
	0b00000001,
	0b00000001,
	0b00000001
	},{
	0b00000100,
	0b00000110,
	0b00000011,
	0b00000001,
	0b00000000,
	0b00000000,
	0b00000000,
	0b00000000
	},{
	0b00000010,
	0b00000011,
	0b00000001,
	0b00000000,
	0b00000000,
	0b00000000,
	0b00000000,
	0b00000000
	},{
	0b00000001,
	0b00000001,
	0b00000000,
	0b00000000,
	0b00000000,
	0b00000000,
	0b00000000,
	0b00000000
}};
	
void x(unsigned char data){
	PORTC&=~(1<<3);
	for(int i=0;i<8;i++){
		PORTC&=~(1<<0);
		if((data&0x80)!=0) PORTC|=(1<<1);
		else PORTC&=~(1<<1);
		PORTC|=(1<<0);
		data<<=1;
		_delay_us(1);
	}
	PORTC|=(1<<3);
}
//2nd shift register
void y(unsigned char data){
	PORTD&=~(1<<3);
	for(int i=0;i<8;i++){
		PORTD&=~(1<<0);
		if((data&0x80)!=0) PORTD|=(1<<1);
		else PORTD&=~(1<<1);
		PORTD|=(1<<0);
		data<<=1;
		_delay_us(1);
	}
	PORTD|=(1<<3);
}
int main(void)
{ DDRD=0xff;
  DDRC=0xff;
 PORTD=0x00;
 PORTC=0x00;
 
 
	int j=0;
	
    while(1)
    {
		for (int k=0;k<17;k++)
		{ for (int i=0;i<500;i++)
		  {
			x(dotcontrol[j]);
			y(d[k][j]);
			j++;
			_delay_ms(dt);
			if(j>7)
			j=0;
		  }
		}
       j=0;
    }
}